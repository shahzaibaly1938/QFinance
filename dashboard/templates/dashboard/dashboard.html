{% extends "base.html" %}

{% block title %}Dashboard | Q Travel Finance{% endblock %}

{% block content %}
<!-- Main content -->
<main>
  <!-- Content header -->
  <div class="flex items-center justify-between px-4 py-4 border-b border-blue-300 lg:py-6 ">
    <h1 class="text-2xl font-semibold text-blue-800 ">Dashboard</h1>
  </div>

  <!-- Content -->
  <div class="mt-2">
    <!-- State cards -->
    <div class="grid grid-cols-1 gap-8 p-4 lg:grid-cols-2 xl:grid-cols-4">
      <!-- Total Sales card -->
      <div class="flex items-center justify-between p-4 bg-blue-50 rounded-md ">
        <div>
          <h6 class="text-xs font-medium tracking-wider text-blue-600 uppercase">
            Total Sales
          </h6>
          <span class="text-xl font-semibold text-blue-900 ">₹{{ total_sales }}</span>
        </div>
        <div>
          <svg class="w-12 h-12 text-blue-300 " fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
      </div>

      <!-- Users card -->
      <div class="flex items-center justify-between p-4 bg-blue-50 rounded-md">
        <div>
          <h6 class="text-xs font-medium tracking-wider text-blue-600 uppercase ">
            Tickets Sold
          </h6>
          <span class="text-xl font-semibold text-blue-900">{{ total_tickets }}</span>
        </div>
        <div>
          <svg class="w-12 h-12 text-blue-300 " fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
          </svg>
        </div>
      </div>

      <!-- Expenses card -->
      <div class="flex items-center justify-between p-4 bg-blue-50 rounded-md ">
        <div>
          <h6 class="text-xs font-medium tracking-wider text-blue-600 uppercase ">
            Expenses
          </h6>
          <span class="text-xl font-semibold text-blue-900 ">₹{{ total_expense }}</span>
        </div>
        <div>
          <svg class="w-12 h-12 text-blue-300 " fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
          </svg>
        </div>
      </div>

      <!-- Commission card -->
      <div class="flex items-center justify-between p-4 bg-blue-50 rounded-md ">
        <div>
          <h6 class="text-xs font-medium tracking-wider text-blue-600 uppercase ">
            Commission Paid
          </h6>
          <span class="text-xl font-semibold text-blue-900 ">₹{{ total_commission }}</span>
        </div>
        <div>
          <svg class="w-12 h-12 text-blue-300 " fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
          </svg>
        </div>
      </div>

      <!-- Net Profit card -->
      <div class="flex items-center justify-between p-4 bg-blue-50 rounded-md ">
        <div>
          <h6 class="text-xs font-medium tracking-wider text-blue-600 uppercase ">
            Net Profit
          </h6>
          <span class="text-xl font-semibold text-green-700 ">₹{{ total_profit }}</span>
        </div>
        <div>
          <svg class="w-12 h-12 text-green-300 " fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M5 13l4 4L19 7" />
          </svg>
        </div>
      </div>
    </div>

    <!-- Charts section -->
    <div class="grid grid-cols-1 p-4 space-y-8 lg:gap-8 lg:space-y-0 lg:grid-cols-3">
      <!-- Bar Chart -->
      <div class="col-span-2 bg-blue-50 rounded-md">
        <div class="flex items-center justify-between p-4 border-b border-blue-300 ">
          <h4 class="text-lg font-semibold text-blue-700 ">Monthly Sales</h4>
        </div>
        <div class="relative p-4 h-72">
          <canvas id="barChart"></canvas>
        </div>
      </div>

      <!-- Doughnut Chart -->
      <div class="bg-blue-50 rounded-md">
        <div class="flex items-center justify-between p-4 border-b border-blue-300 ">
          <h4 class="text-lg font-semibold text-blue-700 ">Sales vs Expenses</h4>
        </div>
        <div class="relative p-4 h-72">
          <canvas id="doughnutChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Bottom charts -->
    <div class="grid grid-cols-1 p-4 space-y-8 lg:gap-8 lg:space-y-0 lg:grid-cols-3">
      <!-- Active users (example, static or replace with your data) -->
      <div class="col-span-1 bg-blue-50 rounded-md ">
        <div class="p-4 border-b border-blue-300 ">
          <h4 class="text-lg font-semibold text-blue-700">Active users right now</h4>
        </div>
        <p class="p-4">
          <span class="text-2xl font-medium text-blue-800 " id="usersCount">--</span>
          <span class="text-sm font-medium text-blue-600 ">Users</span>
        </p>
        <div class="relative p-4">
          <canvas id="activeUsersChart"></canvas>
        </div>
      </div>

      <!-- Line chart -->
      <div class="col-span-2 bg-blue-50 rounded-md ">
        <div class="flex items-center justify-between p-4 border-b border-blue-300 ">
          <h4 class="text-lg font-semibold text-blue-700 ">Sales Trend</h4>
        </div>
        <div class="relative p-4 h-72">
          <canvas id="lineChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Bar Chart - Monthly Sales
  const barChart = new Chart(document.getElementById('barChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: [{% for m in months %}'{{ m }}'{% if not forloop.last %},{% endif %}{% endfor %}],
      datasets: [{
        label: 'Sales',
        data: [{% for s in sales %}{{ s }}{% if not forloop.last %},{% endif %}{% endfor %}],
        backgroundColor: '#1E90FF',
        borderRadius: 8,
        maxBarThickness: 48
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { color: '#2D3748', font: { weight: 'bold' } },
          grid: { color: '#e3e9f2' }
        },
        x: {
          ticks: { color: '#1a237e', font: { weight: 'bold' } },
          grid: { display: false }
        }
      }
    }
  });

  // Doughnut Chart - Sales vs Expenses
  const doughnutChart = new Chart(document.getElementById('doughnutChart').getContext('2d'), {
    type: 'doughnut',
    data: {
      labels: ['Total Sales', 'Total Expenses'],
      datasets: [{
        data: [{{ total_sales|default:0 }}, {{ total_expense|default:0 }}],
        backgroundColor: ['#00FFC6', '#FF3B30'],
        borderWidth: 2
      }]
    },
    options: {
      cutout: '70%',
      plugins: {
        legend: {
          display: true,
          position: 'bottom',
          labels: { color: '#1a237e', font: { weight: 'bold' } }
        }
      }
    }
  });

  // Line Chart - Sales Trend
  const lineChart = new Chart(document.getElementById('lineChart').getContext('2d'), {
    type: 'line',
    data: {
      labels: [{% for m in months %}'{{ m }}'{% if not forloop.last %},{% endif %}{% endfor %}],
      datasets: [{
        label: 'Sales',
        data: [{% for s in sales %}{{ s }}{% if not forloop.last %},{% endif %}{% endfor %}],
        borderColor: '#38B2AC',
        backgroundColor: 'rgba(56,178,172,0.1)',
        fill: true,
        tension: 0.4,
        pointBackgroundColor: '#38B2AC',
        pointBorderColor: '#38B2AC'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { color: '#2D3748' },
          grid: { color: '#e3e9f2' }
        },
        x: {
          ticks: { color: '#1a237e' },
          grid: { display: false }
        }
      }
    }
  });

  // Active Users Chart (example, static data)
  const activeUsersChart = new Chart(document.getElementById('activeUsersChart').getContext('2d'), {
    type: 'doughnut',
    data: {
      labels: ['Active', 'Inactive'],
      datasets: [{
        data: [30, 70],
        backgroundColor: ['#5AFF3D', '#A0AEC0'],
        borderWidth: 2
      }]
    },
    options: {
      cutout: '75%',
      plugins: {
        legend: { display: false }
      }
    }
  });
  // Optionally, set the users count dynamically if you have it in context
  // document.getElementById('usersCount').textContent = {{ active_users|default:0 }};
</script>
{% endblock %}